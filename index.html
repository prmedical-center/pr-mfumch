<!doctype html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå MFU</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Kanit', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); background-attachment: fixed; }
    
    /* Calendar Styling */
    .day-cell { min-height: 100px; transition: 0.2s; background: #fff; border: 1px solid #f3f4f6; display: flex; flex-direction: column; gap: 4px; position: relative; }
    @media (min-width: 768px) { .day-cell { min-height: 120px; } }
    .day-cell:hover { background-color: #fafaeb; }
    .today { border: 2px solid #4f46e5 !important; background-color: #eef2ff; }
    .fully-booked { background-color: #fff1f2 !important; }

    /* Event Badge */
    .event-badge { 
      font-size: 10px; padding: 3px 6px; border-radius: 6px; 
      color: white; cursor: pointer; text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.1s;
    }
    .event-badge:hover { transform: scale(1.02); z-index: 10; }

    /* Modal Animation */
    #event-modal { transition: opacity 0.3s ease-in-out; }
    .hidden-modal { opacity: 0; pointer-events: none; }
    .show-modal { opacity: 1; pointer-events: auto; }
  </style>
</head>
<body class="h-full gradient-bg p-3 md:p-8 flex flex-col min-h-screen">
  <div class="max-w-4xl mx-auto w-full flex-grow">
    
    <div class="text-center text-white mb-8">
      <h1 class="text-2xl md:text-3xl font-bold mb-2">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</h1>
      <p class="opacity-90 text-base font-light">‡∏á‡∏≤‡∏ô‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ ‡∏ù‡πà‡∏≤‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÅ‡∏°‡πà‡∏ü‡πâ‡∏≤‡∏´‡∏•‡∏ß‡∏á</p>
    </div>

    <div class="flex justify-center mb-6 sticky top-2 z-20">
      <div class="bg-white/20 backdrop-blur-md p-1 rounded-full flex gap-1 border border-white/30 shadow-xl">
        <button onclick="switchTab('book')" id="btn-book" class="px-5 py-2 rounded-full text-sm font-semibold transition-all bg-white text-indigo-700 shadow-sm">üìù ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
        <button onclick="switchTab('list')" id="btn-list" class="px-5 py-2 rounded-full text-sm font-semibold text-white hover:bg-white/10 transition-all">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</button>
        <button onclick="switchTab('summary')" id="btn-summary" class="px-5 py-2 rounded-full text-sm font-semibold text-white hover:bg-white/10 transition-all">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô</button>
      </div>
    </div>

    <div id="book-section" class="bg-white rounded-2xl shadow-xl p-6 md:p-8 fade-in">
      <form id="appointment-form" onsubmit="handleSubmit(event)" class="space-y-6">
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="md:col-span-2 text-indigo-700 font-semibold border-b pb-2 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô *</label>
            <input type="text" name="coordinator_name" required class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 outline-none transition">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô *</label>
            <input type="text" name="department" required class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 outline-none transition">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏†‡∏≤‡∏¢‡πÉ‡∏ô *</label>
            <input type="tel" name="phone_internal" required class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 outline-none transition">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô *</label>
            <input type="text" name="event_title" required class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 outline-none transition">
          </div>
        </div>

        <div>
          <label class="block text-indigo-700 font-semibold border-b pb-2 mb-3">
            ‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ô‡∏∏‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏Ç‡πâ‡∏≠) *
          </label>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <label class="flex items-center space-x-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 cursor-pointer transition">
              <input type="checkbox" name="services" value="‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300">
              <span class="text-sm text-gray-700">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û (‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡πá‡∏ö 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</span>
            </label>
            <label class="flex items-center space-x-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 cursor-pointer transition">
              <input type="checkbox" name="services" value="‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300">
              <span class="text-sm text-gray-700">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</span>
            </label>
            <label class="flex items-center space-x-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 cursor-pointer transition">
              <input type="checkbox" name="services" value="‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300">
              <span class="text-sm text-gray-700">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
            </label>
            <label class="flex items-center space-x-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 cursor-pointer transition">
              <input type="checkbox" name="services" value="‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏∑‡πà‡∏≠" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300">
              <span class="text-sm text-gray-700">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏∑‡πà‡∏≠ (‡∏õ‡πâ‡∏≤‡∏¢, ‡πÅ‡∏ú‡πà‡∏ô‡∏û‡∏±‡∏ö)</span>
            </label>
            <label class="flex items-center space-x-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 cursor-pointer transition">
              <input type="checkbox" name="services" value="‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300">
              <span class="text-sm text-gray-700">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</span>
            </label>
            <label class="flex items-center space-x-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 cursor-pointer transition">
              <input type="checkbox" name="services" value="‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300">
              <span class="text-sm text-gray-700">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£</span>
            </label>
            <label class="flex items-center space-x-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 cursor-pointer transition">
              <input type="checkbox" name="services" value="‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Live ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300">
              <span class="text-sm text-gray-700">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Live ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</span>
            </label>
            <label class="flex items-center space-x-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 cursor-pointer transition">
              <input type="checkbox" name="services" value="‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300">
              <span class="text-sm text-gray-700">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å</span>
            </label>
            <div class="md:col-span-2">
              <label class="flex items-center space-x-3 p-3 rounded-lg border border-gray-200 hover:bg-gray-50 cursor-pointer transition">
                <input type="checkbox" id="other-checkbox" value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300">
                <span class="text-sm text-gray-700">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ)</span>
              </label>
              <input type="text" id="services-other" class="hidden mt-2 w-full px-3 py-2 rounded-lg border border-gray-300 bg-gray-50 text-sm focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î...">
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="w-full min-w-0">
                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏á‡∏≤‡∏ô *</label>
                <input type="date" name="preferred_date" id="date-input" required class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-indigo-500 outline-none bg-white">
            </div>
            
            <div class="w-full min-w-0">
                <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ *</label>
                <div class="flex items-center gap-2">
                    <input type="time" name="start_time" required class="flex-1 min-w-0 px-2 py-2 border border-gray-300 rounded-lg text-center outline-none focus:ring-2 focus:ring-indigo-500 bg-white">
                    <span class="text-gray-400">-</span>
                    <input type="time" name="end_time" required class="flex-1 min-w-0 px-2 py-2 border border-gray-300 rounded-lg text-center outline-none focus:ring-2 focus:ring-indigo-500 bg-white">
                </div>
            </div>
        </div>

        <div class="bg-gray-50 p-4 rounded-xl border border-dashed border-gray-300">
           <label class="block text-sm font-medium text-gray-700 mb-2">
             üìÇ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
             <span class="text-xs font-normal text-gray-500 ml-1">- ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡πÑ‡∏ü‡∏•‡πå (PDF, DOC, JPG, PNG)</span>
           </label>
           <div class="space-y-2">
             <input type="file" id="file1" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer">
             <input type="file" id="file2" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer">
             <input type="file" id="file3" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer">
           </div>
        </div>

        <button type="submit" id="submit-btn" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl hover:bg-indigo-700 shadow-lg transition-all transform active:scale-95 flex justify-center items-center gap-2">
          <span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</span>
        </button>
      </form>
    </div>

    <div id="list-section" class="hidden bg-white rounded-2xl shadow-xl p-4 md:p-8">
      <div class="flex justify-between items-center mb-6">
        <h2 id="calendar-month" class="text-xl font-bold text-gray-800 uppercase"></h2>
        <div class="flex gap-2">
          <button onclick="changeMonth(-1)" class="px-3 py-1 border rounded hover:bg-gray-100">‚óÄ</button>
          <button onclick="changeMonth(1)" class="px-3 py-1 border rounded hover:bg-gray-100">‚ñ∂</button>
        </div>
      </div>
      <div class="overflow-x-auto pb-2">
        <div id="calendar-grid" class="grid grid-cols-7 min-w-[700px] border rounded-xl overflow-hidden shadow-sm"></div>
      </div>
    </div>

    <div id="summary-section" class="hidden bg-white rounded-2xl shadow-xl p-6 md:p-10">
      <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
        <h2 class="text-xl font-bold text-gray-800">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</h2>
        <div class="flex gap-2">
            <select id="chart-month" class="border rounded-lg px-3 py-2 text-sm bg-gray-50" onchange="renderCharts()">
                <option value="all">‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                <option value="1">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°</option><option value="2">‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå</option><option value="3">‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°</option>
                <option value="4">‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô</option><option value="5">‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°</option><option value="6">‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô</option>
                <option value="7">‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°</option><option value="8">‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°</option><option value="9">‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô</option>
                <option value="10">‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°</option><option value="11">‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô</option><option value="12">‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°</option>
            </select>
            <select id="chart-year" class="border rounded-lg px-3 py-2 text-sm bg-gray-50" onchange="renderCharts()"></select>
        </div>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100 shadow-sm">
            <h3 class="text-center font-bold text-gray-600 mb-4">üèÜ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h3>
            <canvas id="serviceChart"></canvas>
        </div>
        <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100 shadow-sm">
            <h3 class="text-center font-bold text-gray-600 mb-4">üè¢ ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h3>
            <canvas id="deptChart"></canvas>
        </div>
      </div>
    </div>

  </div>

  <div id="event-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm hidden-modal">
    <div class="bg-white w-full max-w-md mx-4 rounded-2xl shadow-2xl overflow-hidden transform transition-all scale-100">
        <div class="bg-indigo-600 p-4 text-white flex justify-between items-center">
            <h3 class="font-bold text-lg">üìå ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</h3>
            <button onclick="closeModal()" class="text-white/80 hover:text-white text-2xl">&times;</button>
        </div>
        <div class="p-6 space-y-4">
            <div><label class="text-xs text-gray-400 uppercase font-bold">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô</label><p id="m-title" class="text-lg font-semibold text-indigo-700">-</p></div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="text-xs text-gray-400 uppercase font-bold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><p id="m-date" class="font-medium">-</p></div>
                <div><label class="text-xs text-gray-400 uppercase font-bold">‡πÄ‡∏ß‡∏•‡∏≤</label><p id="m-time" class="font-medium">-</p></div>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg border">
                <div><label class="text-xs text-gray-400 uppercase font-bold">‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô</label><p id="m-name" class="font-medium text-gray-800">-</p></div>
                <div class="mt-2"><label class="text-xs text-gray-400 uppercase font-bold">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label><p id="m-dept" class="font-medium text-gray-800">-</p></div>
                <div class="mt-2"><label class="text-xs text-gray-400 uppercase font-bold">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><p id="m-phone" class="font-medium text-gray-800">-</p></div>
            </div>
            <div>
                <label class="text-xs text-gray-400 uppercase font-bold">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ç‡∏≠</label>
                <div id="m-services" class="flex flex-wrap gap-2 mt-1"></div>
            </div>
        </div>
        <div class="p-4 border-t bg-gray-50 text-center">
            <button onclick="closeModal()" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm font-bold text-gray-700">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
        </div>
    </div>
  </div>

  <script>
    // ‚ö†Ô∏è Updated WEB_APP_URL
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwBNjqWX1uj6cKX29C0N-UpfZLcZLoq4RfzYNXw1WE8meLz1wnLuzEf2teAd0qJBsFc/exec";
    
    // --- Configuration ---
    const serviceColors = {
        '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û': '#3b82f6', 
        '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠': '#ef4444', 
        '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå': '#f97316', 
        '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏∑‡πà‡∏≠': '#22c55e', 
        '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå': '#06b6d4', 
        '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£': '#a855f7', 
        '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Live': '#e11d48', 
        '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å': '#ec4899', 
        '‡∏≠‡∏∑‡πà‡∏ô‡πÜ': '#64748b'
    };

    let appointments = [];
    let currentMonth = new Date();
    let serviceChartInstance = null;
    let deptChartInstance = null;

    // --- Date Setup ---
    const todayDate = new Date();
    const yyyy = todayDate.getFullYear();
    const mm = String(todayDate.getMonth() + 1).padStart(2, '0');
    const dd = String(todayDate.getDate()).padStart(2, '0');
    const todayStr = `${yyyy}-${mm}-${dd}`;
    
    const dateInput = document.getElementById('date-input');
    dateInput.min = todayStr;
    dateInput.addEventListener('change', function() {
        if (this.value && this.value < todayStr) {
            alert('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ'); this.value = ''; 
        }
    });

    // Populate Year Select
    const yearSelect = document.getElementById('chart-year');
    for(let i=yyyy; i>=yyyy-2; i--) {
        const opt = document.createElement('option');
        opt.value = i; opt.text = i;
        yearSelect.add(opt);
    }

    // Toggle Other Checkbox
    document.getElementById('other-checkbox').addEventListener('change', (e) => {
        document.getElementById('services-other').classList.toggle('hidden', !e.target.checked);
    });

    // --- Tab Switching ---
    function switchTab(tab) {
        ['book', 'list', 'summary'].forEach(t => {
            document.getElementById(`${t}-section`).classList.toggle('hidden', t !== tab);
            const btn = document.getElementById(`btn-${t}`);
            if(t === tab) {
                btn.className = "px-5 py-2 rounded-full text-sm font-semibold transition-all bg-white text-indigo-700 shadow-sm transform scale-105";
            } else {
                btn.className = "px-5 py-2 rounded-full text-sm font-semibold text-white hover:bg-white/10 transition-all";
            }
        });
        if(tab === 'list') { fetchData(); }
        if(tab === 'summary') { fetchData().then(() => renderCharts()); }
    }

    // --- Form Submission ---
    async function handleSubmit(e) {
        e.preventDefault();
        const fd = new FormData(e.target);
        const selDate = fd.get('preferred_date');

        if (selDate < todayStr) { alert("‚ö†Ô∏è ‡∏´‡πâ‡∏≤‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á"); return; }

        const dailyCount = appointments.filter(a => a.preferred_date === selDate).length;
        if (dailyCount >= 2) { alert(`‚ùå ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${selDate} ‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß (2/2)`); return; }

        let svcs = Array.from(e.target.querySelectorAll('input[name="services"]:checked')).map(c => c.value);
        if(document.getElementById('other-checkbox').checked) {
            const otherTxt = document.getElementById('services-other').value.trim();
            svcs.push(otherTxt ? `‡∏≠‡∏∑‡πà‡∏ô‡πÜ (${otherTxt})` : "‡∏≠‡∏∑‡πà‡∏ô‡πÜ");
        }
        if(svcs.length === 0) { alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ç‡πâ‡∏≠"); return; }

        let files = []; 
        for(let i=1; i<=3; i++) { 
            if(document.getElementById(`file${i}`).files[0]) files.push(document.getElementById(`file${i}`).files[0].name); 
        }

        const payload = {
            coordinator_name: fd.get('coordinator_name'),
            department: fd.get('department'),
            phone_internal: fd.get('phone_internal'),
            event_title: fd.get('event_title'),
            services: svcs.join(', '),
            preferred_date: selDate,
            time_range: `${fd.get('start_time')} - ${fd.get('end_time')}`,
            attachment_name: files.join(', ') || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå"
        };

        const btn = document.getElementById('submit-btn');
        btn.disabled = true; btn.innerHTML = "<span>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...</span>";
        
        try {
            await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify(payload) });
            alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); 
            e.target.reset(); 
            document.getElementById('services-other').classList.add('hidden');
            switchTab('list');
        } catch (err) { 
            alert("‚ö†Ô∏è ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡πå)"); 
            switchTab('list');
        } finally { 
            btn.disabled = false; btn.innerHTML = "<span>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</span>"; 
        }
    }

    async function fetchData() {
        try {
            const res = await fetch(WEB_APP_URL);
            appointments = await res.json();
            renderCalendar();
        } catch (err) { console.error("Fetch Error"); }
    }

    // --- Gradient & Color Logic ---
    function getGradientStyle(serviceString) {
        const services = serviceString.split(',').map(s => {
            // ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà Keyword ‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏¢‡∏≤‡∏ß‡πÜ
            if(s.includes('‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û')) return serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û'];
            if(s.includes('‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠')) return serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠'];
            if(s.includes('‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå')) return serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå'];
            if(s.includes('‡∏õ‡πâ‡∏≤‡∏¢')) return serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏∑‡πà‡∏≠'];
            if(s.includes('‡∏Ç‡πà‡∏≤‡∏ß')) return serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå'];
            if(s.includes('‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£')) return serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£'];
            if(s.includes('Live')) return serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Live'];
            if(s.includes('‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å')) return serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å'];
            return serviceColors['‡∏≠‡∏∑‡πà‡∏ô‡πÜ'];
        });
        
        if (services.length === 0) return 'background: #64748b';
        if (services.length === 1) return `background: ${services[0]}`;
        return `background: linear-gradient(135deg, ${services.join(', ')})`;
    }

    // --- Calendar Rendering ---
    function renderCalendar() {
        const grid = document.getElementById('calendar-grid');
        const monthLabel = document.getElementById('calendar-month');
        grid.innerHTML = '<div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold">‡∏≠‡∏≤</div><div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold">‡∏à</div><div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold">‡∏≠</div><div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold">‡∏û</div><div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold">‡∏û‡∏§</div><div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold">‡∏®</div><div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold">‡πÄ‡∏™</div>';
        
        monthLabel.textContent = currentMonth.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' });
        const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1).getDay();
        const daysInMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) { grid.appendChild(document.createElement('div')); }

        for (let d = 1; d <= daysInMonth; d++) {
            const dateStr = `${currentMonth.getFullYear()}-${String(currentMonth.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const dailyEvents = appointments.filter(a => a.preferred_date === dateStr);
            
            const cell = document.createElement('div');
            const bgClass = (dailyEvents.length >= 2) ? 'fully-booked' : '';
            const todayClass = (dateStr === todayStr) ? 'today' : '';
            cell.className = `day-cell p-1 md:p-2 ${bgClass} ${todayClass}`;
            
            cell.innerHTML = `<div class="text-xs font-bold text-gray-400 flex justify-between">${d} ${dailyEvents.length>=2 ?'<span class="text-red-500 text-[9px]">‡πÄ‡∏ï‡πá‡∏°</span>':''}</div>`;
            
            dailyEvents.forEach((event) => {
                const b = document.createElement('div');
                b.className = "event-badge";
                b.style = getGradientStyle(event.services);
                b.innerHTML = `‚è∞ ${event.preferred_time || event.time_range.split('-')[0]} | ${event.event_title}`;
                b.onclick = (e) => { e.stopPropagation(); openModal(event); };
                cell.appendChild(b);
            });

            grid.appendChild(cell);
        }
    }
    function changeMonth(s) { currentMonth.setMonth(currentMonth.getMonth() + s); renderCalendar(); }

    // --- Modal Functions ---
    const modal = document.getElementById('event-modal');
    function openModal(data) {
        document.getElementById('m-title').innerText = data.event_title;
        document.getElementById('m-date').innerText = new Date(data.preferred_date).toLocaleDateString('th-TH', {dateStyle:'long'});
        document.getElementById('m-time').innerText = data.time_range || data.preferred_time;
        document.getElementById('m-name').innerText = data.coordinator_name;
        document.getElementById('m-dept').innerText = data.department;
        document.getElementById('m-phone').innerText = data.phone_internal;
        
        const svcsDiv = document.getElementById('m-services');
        svcsDiv.innerHTML = '';
        data.services.split(',').forEach(s => {
            const span = document.createElement('span');
            let color = '#64748b';
            // Simple keyword matching for colors in modal
            if(s.includes('‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û')) color = serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û'];
            else if(s.includes('‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠')) color = serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠'];
            else if(s.includes('‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå')) color = serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå'];
            else if(s.includes('‡∏õ‡πâ‡∏≤‡∏¢')) color = serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏∑‡πà‡∏≠'];
            else if(s.includes('‡∏Ç‡πà‡∏≤‡∏ß')) color = serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå'];
            else if(s.includes('‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£')) color = serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£'];
            else if(s.includes('Live')) color = serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Live'];
            else if(s.includes('‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å')) color = serviceColors['‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å'];

            span.className = "text-[10px] text-white px-2 py-1 rounded shadow-sm";
            span.style.backgroundColor = color;
            span.innerText = s.trim();
            svcsDiv.appendChild(span);
        });

        modal.classList.remove('hidden-modal');
        modal.classList.add('show-modal');
    }
    function closeModal() {
        modal.classList.remove('show-modal');
        modal.classList.add('hidden-modal');
    }

    // --- Charts Logic ---
    function renderCharts() {
        const selMonth = document.getElementById('chart-month').value;
        const selYear = document.getElementById('chart-year').value;

        const filtered = appointments.filter(a => {
            const d = new Date(a.preferred_date);
            const mMatch = selMonth === 'all' || (d.getMonth() + 1) == selMonth;
            const yMatch = d.getFullYear() == selYear;
            return mMatch && yMatch;
        });

        // 1. Service Stats
        const svcStats = {};
        filtered.forEach(a => {
            a.services.split(',').forEach(s => {
                let key = '‡∏≠‡∏∑‡πà‡∏ô‡πÜ';
                if(s.includes('‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û')) key = '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û';
                else if(s.includes('‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠')) key = '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠';
                else if(s.includes('‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå')) key = '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå';
                else if(s.includes('‡∏õ‡πâ‡∏≤‡∏¢')) key = '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏∑‡πà‡∏≠';
                else if(s.includes('‡∏Ç‡πà‡∏≤‡∏ß')) key = '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå';
                else if(s.includes('‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£')) key = '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£';
                else if(s.includes('Live')) key = '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Live';
                else if(s.includes('‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å')) key = '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å';
                
                svcStats[key] = (svcStats[key] || 0) + 1;
            });
        });

        // 2. Department Stats
        const deptStats = {};
        filtered.forEach(a => {
            deptStats[a.department] = (deptStats[a.department] || 0) + 1;
        });

        if(serviceChartInstance) serviceChartInstance.destroy();
        if(deptChartInstance) deptChartInstance.destroy();

        const ctx1 = document.getElementById('serviceChart').getContext('2d');
        serviceChartInstance = new Chart(ctx1, {
            type: 'doughnut',
            data: {
                labels: Object.keys(svcStats),
                datasets: [{
                    data: Object.values(svcStats),
                    backgroundColor: Object.keys(svcStats).map(k => serviceColors[k] || '#ccc')
                }]
            }
        });

        const ctx2 = document.getElementById('deptChart').getContext('2d');
        deptChartInstance = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: Object.keys(deptStats),
                datasets: [{
                    label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô',
                    data: Object.values(deptStats),
                    backgroundColor: '#4f46e5',
                    borderRadius: 5
                }]
            },
            options: { scales: { y: { beginAtZero: true, ticks: {stepSize:1} } } }
        });
    }

    fetchData();
  </script>
</body>
</html>
