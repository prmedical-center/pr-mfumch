<!doctype html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Kanit', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); background-attachment: fixed; }
    .day-cell { min-height: 110px; border: 1px solid #f3f4f6; transition: 0.2s; background: #fff; }
    .day-cell:hover { background-color: #f5f3ff; }
    .today { border: 2px solid #4f46e5 !important; background-color: #eef2ff; }
    .event-badge { font-size: 10px; padding: 2px 4px; border-radius: 4px; margin-top: 2px; background: #4f46e5; color: white; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .booked { background-color: #fee2e2; cursor: not-allowed; }
  </style>
</head>
<body class="h-full gradient-bg p-4 md:p-8">
  <div class="max-w-5xl mx-auto">
    <div class="text-center text-white mb-10">
      <h1 id="app-title" class="text-3xl md:text-4xl font-bold text-white mb-2">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</h1>
      <p id="app-subtitle" class="text-white/80 text-lg">‡∏á‡∏≤‡∏ô‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ ‡∏ù‡πà‡∏≤‡∏¢‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</p>
      <p class="text-white/90 text-base mt-3 max-w-3xl mx-auto">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÅ‡∏°‡πà‡∏ü‡πâ‡∏≤‡∏´‡∏•‡∏ß‡∏á</p>
    </div>
      <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-6 mt-6 text-left text-white/90 text-sm max-w-3xl mx-auto">
       <p class="font-semibold mb-3">üìã ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°:</p>
       <ul class="space-y-2 ml-4">
        <li>‚Ä¢ ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå (10‚Äì20 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£)</li>
        <li>‚Ä¢ ‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ (10 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£)</li>
        <li>‚Ä¢ ‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ 30 ‡∏ß‡∏±‡∏ô)</li>
        <li>‚Ä¢ ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå (1‚Äì3 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£)</li>
        <li>‚Ä¢ ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏ï‡∏π‡∏î‡∏¥‡πÇ‡∏≠</li>
        <li>‚Ä¢ ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏´‡∏≤‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</li>
        <li>‚Ä¢ ‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</li>
       </ul>
       <p class="font-semibold text-yellow-200 mt-4">‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 15 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</p>
      </div>
    <div class="flex justify-center mb-8">
      <div class="bg-black/20 p-1.5 rounded-full flex gap-2 border border-white/10">
        <button onclick="showTab('book')" id="btn-book" class="px-8 py-2.5 rounded-full font-medium bg-white text-indigo-600 shadow-lg transition-all">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏´‡∏°‡πà</button>
        <button onclick="showTab('list')" id="btn-list" class="px-8 py-2.5 rounded-full font-medium text-white hover:bg-white/10 transition-all">‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</button>
      </div>
    </div>

    <div id="book-section" class="bg-white rounded-[2rem] shadow-2xl p-8 md:p-10 fade-in">
      <form id="appointment-form" onsubmit="handleSubmit(event)">
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡∏á‡∏≤‡∏ô) *</label>
            <input type="text" name="coordinator_name" required class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:ring-2 focus:ring-indigo-400">
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô *</label>
            <input type="text" name="department" required class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:ring-2 focus:ring-indigo-400">
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏†‡∏≤‡∏¢‡πÉ‡∏ô *</label>
            <input type="tel" name="phone_internal" required class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:ring-2 focus:ring-indigo-400">
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô/‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° *</label>
            <input type="text" name="event_title" required class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:ring-2 focus:ring-indigo-400">
          </div>
          
          <div class="md:col-span-2">
            <label class="block text-sm font-semibold text-gray-600 mb-2">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ô‡∏∏‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå *</label>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 bg-gray-50 p-5 rounded-xl border border-dashed border-gray-300">
              <label class="flex items-center gap-2 text-sm cursor-pointer"><input type="checkbox" name="services" value="‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠"> ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠</label>
              <label class="flex items-center gap-2 text-sm cursor-pointer"><input type="checkbox" name="services" value="‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå"> ‡∏ú‡∏•‡∏¥‡∏ï‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</label>
              <label class="flex items-center gap-2 text-sm cursor-pointer"><input type="checkbox" name="services" value="‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠"> ‡∏ï‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</label>
              <label class="flex items-center gap-2 text-sm cursor-pointer"><input type="checkbox" name="services" value="‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°"> ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
              <label class="flex items-center gap-2 text-sm cursor-pointer"><input type="checkbox" name="services" value="‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå"> ‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</label>
              <label class="flex items-center gap-2 text-sm cursor-pointer"><input type="checkbox" name="services" value="‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏ï‡∏π‡∏î‡∏¥‡πÇ‡∏≠"> ‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏ï‡∏π‡∏î‡∏¥‡πÇ‡∏≠</label>
              <label class="flex items-center gap-2 text-sm cursor-pointer"><input type="checkbox" name="services" value="‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£"> ‡∏û‡∏¥‡∏ò‡∏µ‡∏Å‡∏£</label>
              <label class="flex items-center gap-2 text-sm cursor-pointer font-bold text-indigo-600"><input type="checkbox" id="other-checkbox" value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ"> ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</label>
            </div>
            <input type="text" id="services-other" class="hidden mt-3 w-full px-4 py-2 rounded-xl border border-gray-200 outline-none focus:ring-2 focus:ring-indigo-400 text-sm" placeholder="‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°...">
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏á‡∏≤‡∏ô (‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ 1 ‡∏á‡∏≤‡∏ô/‡∏ß‡∏±‡∏ô) *</label>
            <input type="date" name="preferred_date" id="date-input" required class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none focus:ring-2 focus:ring-indigo-400">
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-600 mb-1">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏£‡∏¥‡πà‡∏° - ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î) *</label>
            <div class="flex items-center gap-2">
              <input type="time" name="start_time" required class="w-full px-3 py-3 rounded-xl border border-gray-200 outline-none">
              <span>-</span>
              <input type="time" name="end_time" required class="w-full px-3 py-3 rounded-xl border border-gray-200 outline-none">
            </div>
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-semibold text-gray-600 mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà *</label>
            <input type="text" name="location" required class="w-full px-4 py-3 rounded-xl border border-gray-200 outline-none" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ä‡∏±‡πâ‡∏ô 3 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å">
          </div>
          
          <div class="md:col-span-2 space-y-2 mt-4">
            <label class="block text-sm font-semibold text-gray-600 mb-1">‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡πÑ‡∏ü‡∏•‡πå)</label>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
              <input type="file" id="file1" class="w-full text-[10px] border p-2 rounded-xl">
              <input type="file" id="file2" class="w-full text-[10px] border p-2 rounded-xl">
              <input type="file" id="file3" class="w-full text-[10px] border p-2 rounded-xl">
            </div>
          </div>
        </div>
        <button type="submit" id="submit-btn" class="w-full mt-8 bg-indigo-600 text-white font-bold py-4 rounded-2xl hover:bg-indigo-700 transition-all flex items-center justify-center gap-3">
          <span id="btn-text">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</span>
          <div id="spinner" class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin hidden"></div>
        </button>
      </form>
    </div>

    <div id="list-section" class="hidden bg-white rounded-[2rem] shadow-2xl p-6 md:p-8 overflow-hidden">
      <div class="flex justify-between items-center mb-6">
        <h2 id="calendar-month" class="text-2xl font-bold text-gray-800 uppercase"></h2>
        <div class="flex gap-2">
          <button onclick="changeMonth(-1)" class="px-4 py-2 border rounded-lg hover:bg-gray-50 transition-colors">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
          <button onclick="changeMonth(1)" class="px-4 py-2 border rounded-lg hover:bg-gray-50 transition-colors">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
        </div>
      </div>
      <div id="calendar-grid" class="grid grid-cols-7 gap-px bg-gray-200 border border-gray-200 rounded-xl overflow-hidden shadow-inner">
        <div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold uppercase">‡∏≠‡∏≤</div>
        <div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold uppercase">‡∏à</div>
        <div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold uppercase">‡∏≠</div>
        <div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold uppercase">‡∏û</div>
        <div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold uppercase">‡∏û‡∏§</div>
        <div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold uppercase">‡∏®</div>
        <div class="bg-indigo-600 text-white py-2 text-center text-xs font-bold uppercase">‡∏™</div>
      </div>
      <p class="mt-4 text-center text-gray-400 text-[10px] italic">* ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</p>
    </div>
  </div>

  <script>
    // ‚ö†Ô∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwBNjqWX1uj6cKX29C0N-UpfZLcZLoq4RfzYNXw1WE8meLz1wnLuzEf2teAd0qJBsFc/exec";
    
    let appointments = [];
    let currentMonth = new Date();
    document.getElementById('date-input').min = new Date().toISOString().split('T')[0];

    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ä‡πà‡∏≠‡∏á "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"
    document.getElementById('other-checkbox').addEventListener('change', function(e) {
      document.getElementById('services-other').classList.toggle('hidden', !e.target.checked);
    });

    function showTab(tab) {
      const isBook = tab === 'book';
      document.getElementById('book-section').classList.toggle('hidden', !isBook);
      document.getElementById('list-section').classList.toggle('hidden', isBook);
      document.getElementById('btn-book').className = isBook ? "px-8 py-2.5 rounded-full font-medium bg-white text-indigo-600 shadow-lg" : "px-8 py-2.5 rounded-full font-medium text-white hover:bg-white/10";
      document.getElementById('btn-list').className = !isBook ? "px-8 py-2.5 rounded-full font-medium bg-white text-indigo-600 shadow-lg" : "px-8 py-2.5 rounded-full font-medium text-white hover:bg-white/10";
      if(!isBook) fetchData();
    }

    async function handleSubmit(e) {
      e.preventDefault();
      const fd = new FormData(e.target);
      const selDate = fd.get('preferred_date');

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ã‡πâ‡∏≥‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (Frontend)
      if (appointments.some(a => a.preferred_date === selDate)) {
        alert("‚ùå ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô");
        return;
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
      let services = Array.from(e.target.querySelectorAll('input[name="services"]:checked')).map(c => c.value);
      const otherValue = document.getElementById('services-other').value;
      if(document.getElementById('other-checkbox').checked && otherValue) {
        services = services.filter(s => s !== "‡∏≠‡∏∑‡πà‡∏ô‡πÜ");
        services.push("‡∏≠‡∏∑‡πà‡∏ô ‡πÜ: " + otherValue);
      }
      if(services.length === 0) { alert("‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"); return; }

      const btn = document.getElementById('submit-btn');
      const spinner = document.getElementById('spinner');
      const txt = document.getElementById('btn-text');

      let fileNames = [];
      for(let i=1; i<=3; i++) {
        const fInput = document.getElementById(`file${i}`);
        if(fInput.files.length > 0) fileNames.push(fInput.files[0].name);
      }

      const payload = {
        coordinator_name: fd.get('coordinator_name'),
        department: fd.get('department'),
        phone_internal: fd.get('phone_internal'),
        event_title: fd.get('event_title'),
        services: services.join(', '),
        location: fd.get('location'),
        preferred_date: selDate,
        time_range: `${fd.get('start_time')} - ${fd.get('end_time')}`,
        attachment_name: fileNames.length > 0 ? fileNames.join(', ') : "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö"
      };

      btn.disabled = true; spinner.classList.remove('hidden'); txt.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠...";

      try {
        const response = await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify(payload) });
        const result = await response.json();

        if (result.status === "success") {
          alert("‚úîÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏¥‡∏ß‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
          e.target.reset();
          document.getElementById('services-other').classList.add('hidden');
          await fetchData();
          showTab('list');
        } else {
          alert("‚ùå " + result.message);
        }
      } catch (err) {
        alert("‚ö†Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ö‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á)");
        e.target.reset();
        await fetchData();
        showTab('list');
      } finally {
        btn.disabled = false; spinner.classList.add('hidden'); txt.textContent = "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß";
      }
    }

    async function fetchData() {
      try {
        const res = await fetch(WEB_APP_URL);
        appointments = await res.json();
        renderCalendar();
      } catch (err) { console.error("Fetch error"); }
    }

    function renderCalendar() {
      const grid = document.getElementById('calendar-grid');
      const monthLabel = document.getElementById('calendar-month');
      grid.querySelectorAll('.day-cell').forEach(d => d.remove());
      
      monthLabel.textContent = currentMonth.toLocaleDateString('th-TH', { month: 'long', year: 'numeric' });
      const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1).getDay();
      const daysInMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0).getDate();
      const today = new Date().toLocaleDateString('en-CA');

      for (let i = 0; i < firstDay; i++) {
        const empty = document.createElement('div'); empty.className = "day-cell bg-gray-50";
        grid.appendChild(empty);
      }

      for (let d = 1; d <= daysInMonth; d++) {
        const dateObj = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), d);
        const dateStr = dateObj.toLocaleDateString('en-CA');
        const event = appointments.find(a => a.preferred_date === dateStr);
        
        const cell = document.createElement('div');
        cell.className = `day-cell p-2 ${event ? 'booked' : ''} ${dateStr === today ? 'today' : ''}`;
        cell.innerHTML = `<div class="text-xs font-bold ${dateStr === today ? 'text-indigo-600' : 'text-gray-400'}">${d}</div>`;
        
        if (event) {
          const b = document.createElement('div');
          b.className = "event-badge";
          b.textContent = `‚è∞ ${event.preferred_time}`;
          cell.appendChild(b);
          const t = document.createElement('div');
          t.className = "text-[9px] font-medium truncate text-indigo-700 mt-1";
          t.textContent = event.event_title;
          cell.appendChild(t);
        }
        grid.appendChild(cell);
      }
    }

    function changeMonth(s) { currentMonth.setMonth(currentMonth.getMonth() + s); renderCalendar(); }
    fetchData();
  </script>
</body>
</html>
